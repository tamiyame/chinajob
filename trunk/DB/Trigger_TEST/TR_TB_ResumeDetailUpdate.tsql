set ANSI_NULLS ON
set QUOTED_IDENTIFIER ON
GO
ALTER TRIGGER [dbo].[TR_TB_ResumeDetailUpdate] ON [dbo].[TB_ResumeDetail]
FOR UPDATE
AS

DECLARE @UserNo int
DECLARE @CountryNo int
DECLARE @KRName nvarchar( 20 )
DECLARE @CNName	nvarchar( 20 )
DECLARE @ENGName	nvarchar( 20 )
DECLARE @UserImage	varchar( 200 )
DECLARE @JoinType tinyint
DECLARE @Category1No int
DECLARE @Category2No int
declare @CategoryEtc nvarchar( 200 )
DECLARE @CityCategory int
DECLARE @AreaCategory int
DECLARE @Age int
DECLARE @KoreanAge int
DECLARE @Gender tinyint
DECLARE @Career int
DECLARE @RegistryTime datetime

SELECT 
	@UserNo = UserNo
,	@CountryNo = CountryNo
,	@Age = Age
,	@KoreanAge = KoreanAge
,	@Career = IsCareer
FROM 
	INSERTED

SELECT
	@KRName = KRName
,	@CNName = CNName
,	@ENGName = ENGName
,	@Gender = Gender
,	@UserImage = ImageUrl
FROM
	dbo.TB_User with ( nolock )
WHERE
	UserNo = @UserNo

SELECT
	@CityCategory = CityNo1
,	@AreaCategory = ArrayNo1
,	@JoinType = JoinType
,	@Category1No = Category1No
,	@Category2No = Category2No
,	@CategoryEtc = CategoryEtc
,	@RegistryTime = RegistryTime
FROM
	dbo.TB_Resume with ( nolock )
WHERE
	UserNo = @UserNo

IF EXISTS (SELECT UserNo FROM dbo.TB_ResumeSearch WITH(NOLOCK) WHERE UserNo = @UserNo AND CountryNo = @CountryNo )
BEGIN
	UPDATE
		dbo.TB_ResumeSearch
	SET
		KRName = @KRName
	,	CNName = @CNName
	,	ENGName = @ENGName
	,	UserImage = @UserImage
	,	JoinType = @JoinType
	,	Category1No = @Category1No
	,	Category2No = @Category2No
	,	CategoryEtc = @CategoryEtc
	,	CityCategory = @CityCategory
	,	AreaCategory = @AreaCategory
	,	KoreanAge = @KoreanAge
	,	Age = @Age
	,	Gender = @Gender
	,	Career = @Career
	,	RegistryTime = @RegistryTime
	WHERE
		UserNo = @UserNo
	AND	CountryNo = @CountryNo
END



